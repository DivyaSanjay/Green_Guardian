import matplotlib.pyplot as plt
import datetime
import pytz

# Sample data
data = [
[1717102141, 22.700001, 64.000000, 0.000000, 1, 52, 0, 100],
[1717102225, 23.000000, 64.000000, 4.166667, 1, 52, 0, 100],
[1717102302, 22.900000, 63.000000, 4.166667, 1, 47, 0, 100],
[1717105860, 24.000000, 62.000000, 6.666667, 1, 45, 0, 94],
[1717109460, 23.700001, 62.000000, 0.000000, 1, 39, 0, 90],
[1717161253, 22.799999, 64.000000, 1546.666626, 1, 50, 0, 43],
[1717161978, 23.700001, 62.000000, 1195.000000, 1, 52, 0, 44],
[1717170463, 26.900000, 56.000000, 18937.500000, 0, 0, 43, 86],
[1717170523, 26.799999, 55.000000, 18548.333984, 0, 0, 37, 85],
[1717170626, 26.400000, 54.000000, 18898.333984, 0, 34, 0, 86],
[1717170727, 25.900000, 56.000000, 18200.000000, 0, 35, 0, 95],
[1717170974, 26.299999, 56.000000, 17941.666016, 0, 33, 0, 85],
[1717171070, 26.000000, 55.000000, 18127.500000, 0, 33, 0, 86],
[1717171121, 25.900000, 55.000000, 17600.833984, 0, 33, 0, 86],
[1717171140, 25.900000, 55.000000, 17636.666016, 0, 34, 0, 85],
[1717171417, 25.500000, 56.000000, 16412.500000, 0, 33, 0, 86],
[1717171440, 25.500000, 56.000000, 17078.333984, 0, 33, 0, 86],
[1717171500, 25.500000, 56.000000, 16593.333984, 0, 33, 0, 86],
[1717171560, 25.400000, 56.000000, 15078.333008, 0, 33, 0, 86],
[1717171620, 25.299999, 56.000000, 16176.666992, 0, 32, 0, 87],
[1717171680, 25.400000, 57.000000, 14153.333008, 1, 32, 0, 86],
[1717171844, 25.299999, 57.000000, 12835.000000, 1, 73, 0, 87],
[1717171860, 25.299999, 57.000000, 6569.166504, 1, 63, 0, 86],
[1717171920, 25.299999, 57.000000, 3613.333252, 1, 53, 0, 86],
[1717171980, 25.100000, 57.000000, 2875.000000, 1, 51, 0, 86],
[1717172040, 25.000000, 58.000000, 1209.166626, 1, 60, 24, 86],
[1717172520, 24.900000, 60.000000, 1246.666626, 1, 60, 24, 86],
[1717172580, 24.799999, 60.000000, 1708.333374, 1, 58, 21, 86],
[1717172640, 24.799999, 60.000000, 1740.000000, 1, 58, 22, 95],
[1717172700, 24.700001, 60.000000, 1290.000000, 1, 56, 27, 86],
[1717172760, 24.700001, 60.000000, 2835.833252, 1, 56, 33, 86],
[1717172832, 24.799999, 60.000000, 8853.333008, 1, 56, 33, 86],
[1717172876, 24.799999, 61.000000, 8416.666992, 1, 51, 32, 84],
[1717173160, 25.200001, 57.000000, 8414.166992, 1, 50, 31, 68],
[1717173223, 25.200001, 58.000000, 5147.500000, 1, 50, 31, 66],
[1717173516, 25.400000, 58.000000, 8815.000000, 1, 47, 30, 75],
[1717173564, 25.400000, 58.000000, 5364.166504, 1, 46, 31, 66],
[1717173758, 25.299999, 58.000000, 1055.833374, 1, 50, 45, 77],
[1717173859, 25.100000, 59.000000, 1034.166626, 1, 49, 46, 78],
[1717177440, 24.000000, 62.000000, 1105.833374, 1, 48, 46, 80],
[1717181040, 24.200001, 61.000000, 137.500000, 1, 48, 46, 83],
[1717184640, 24.000000, 61.000000, 15.000000, 1, 48, 46, 83],
[1717188240, 24.600000, 62.000000, 0.833333, 1, 48, 46, 83],
[1717191840, 24.600000, 62.000000, 7.500000, 1, 48, 45, 83],
[1717195440, 24.200001, 63.000000, 0.000000, 1, 48, 45, 83],
[1717199040, 23.700001, 64.000000, 0.000000, 1, 46, 44, 83],
[1717202640, 23.500000, 63.000000, 0.000000, 1, 46, 43, 83],
[1717206240, 23.400000, 63.000000, 0.000000, 1, 45, 43, 83],
[1717209840, 23.400000, 63.000000, 0.000000, 1, 44, 43, 83],
[1717213440, 23.400000, 63.000000, 0.000000, 1, 43, 42, 83],
[1717217040, 23.400000, 62.000000, 0.000000, 1, 41, 41, 83],
[1717220640, 23.299999, 62.000000, 0.000000, 1, 40, 40, 83],
[1717224240, 23.200001, 62.000000, 0.833333, 1, 38, 40, 83],
[1717227840, 23.200001, 62.000000, 4.166667, 1, 36, 39, 83],
[1717231440, 23.500000, 62.000000, 9.166667, 1, 36, 39, 82],
[1717235040, 23.500000, 63.000000, 208.333328, 1, 35, 38, 82],
[1717238640, 23.400000, 63.000000, 636.666687, 1, 34, 38, 82],
[1717242240, 23.100000, 59.000000, 925.833313, 1, 33, 37, 82],
[1717245840, 23.100000, 56.000000, 1375.000000, 1, 31, 36, 83],
[1717249440, 23.100000, 57.000000, 819.166687, 1, 30, 35, 83],
[1717253040, 23.299999, 60.000000, 981.666687, 1, 29, 34, 83],
[1717256640, 24.799999, 58.000000, 19535.833984, 1, 27, 33, 85],
[1717260240, 24.000000, 60.000000, 8866.666992, 1, 26, 32, 89],
[1717263840, 23.600000, 61.000000, 688.333313, 1, 25, 30, 89],
[1717267440, 23.500000, 62.000000, 190.833328, 1, 23, 30, 89],
[1717271040, 23.400000, 62.000000, 19.166666, 1, 23, 29, 89],
[1717274640, 23.299999, 62.000000, 0.000000, 1, 22, 28, 88],
[1717278240, 23.400000, 61.000000, 0.000000, 1, 0, 27, 88],
[1717281840, 23.299999, 62.000000, 0.000000, 1, 0, 27, 88],
[1717285440, 23.299999, 62.000000, 1.666667, 1, 0, 26, 89],
[1717289040, 23.200001, 62.000000, 1.666667, 1, 0, 26, 88],
[1717292640, 23.200001, 62.000000, 1.666667, 0, 0, 26, 88],
[1717296240, 23.200001, 62.000000, 1.666667, 0, 0, 26, 88],
[1717299840, 23.000000, 63.000000, 0.000000, 0, 0, 25, 88],
[1717303440, 23.000000, 63.000000, 0.000000, 0, 0, 25, 88],
[1717307040, 23.000000, 63.000000, 0.000000, 0, 0, 25, 88],
[1717310640, 22.900000, 63.000000, 0.833333, 0, 0, 25, 88],
[1717314240, 22.900000, 63.000000, 5.000000, 0, 0, 24, 88],
[1717317840, 23.000000, 63.000000, 16.666666, 0, 49, 23, 89],
[1717321740, 22.900000, 63.000000, 17.500000, 0, 46, 23, 88],
[1717325640, 22.900000, 61.000000, 531.666687, 0, 27, 61, 88],
[1717329240, 23.100000, 62.000000, 604.166687, 1, 25, 66, 88],
[1717332840, 23.400000, 62.000000, 894.166687, 1, 24, 66, 88],
[1717336440, 23.400000, 63.000000, 728.333313, 1, 23, 65, 88],
[1717340040, 23.500000, 62.000000, 730.833313, 1, 22, 65, 89],
[1717343640, 23.600000, 62.000000, 809.166687, 1, 20, 64, 88],
[1717347240, 23.700001, 61.000000, 1470.833374, 1, 57, 64, 89],
[1717351140, 23.400000, 61.000000, 1008.333313, 1, 46, 64, 89],
[1717354740, 23.200001, 63.000000, 429.166656, 1, 44, 64, 89],
[1717358340, 23.100000, 62.000000, 45.833332, 1, 43, 63, 89],
[1717361940, 23.200001, 62.000000, 6.666667, 1, 42, 62, 89],
[1717360776, 23.600000, 63.000000, 7.500000, 1, 48, 68, 85],


]

# Set timezone to PDT
pdt = pytz.timezone('GMT')

# Unpack data
timestamps = [datetime.datetime.fromtimestamp(item[0], pdt) for item in data]
temperatures = [item[1] for item in data]
humidity = [item[2] for item in data]
lux_values = [item[3] for item in data]
water_levels = [item[4] for item in data]
soil_moisture_plant1 = [item[5] for item in data]
soil_moisture_plant2 = [item[6] for item in data]
battery_percentages = [item[7] for item in data]

# Define the range
lower_bound = 20
upper_bound = 100

# Calculate the percentage of values within the range
count_within_range = sum(lower_bound <= value <= upper_bound for value in soil_moisture_plant1)
total_count = len(soil_moisture_plant1)
percentage_within_range = (count_within_range / total_count) * 100
print(percentage_within_range)

# Calculate the percentage of values within the range
count_within_range = sum(lower_bound <= value <= upper_bound for value in soil_moisture_plant2)
total_count = len(soil_moisture_plant1)
percentage_within_range = (count_within_range / total_count) * 100
print(percentage_within_range)
# Create subplots
fig, axs = plt.subplots(4, 2, figsize=(15, 10), constrained_layout=True)
fig.suptitle('Environmental Data Visualization')

# Temperature plot
axs[0, 0].plot(timestamps, temperatures, marker='o')
axs[0, 0].set_title('Temperature')
axs[0, 0].set_ylabel('Temperature (Â°C)')

# Humidity plot
axs[0, 1].plot(timestamps, humidity, marker='o', color='orange')
axs[0, 1].set_title('Humidity')
axs[0, 1].set_ylabel('Humidity (%)')
axs[0, 1].set_ylim(0, 100)

# Lux value plot
axs[1, 0].plot(timestamps, lux_values, marker='o', color='green')
axs[1, 0].set_title('Lux Value')
axs[1, 0].set_ylabel('Lux')

# Water level plot
axs[1, 1].plot(timestamps, water_levels, marker='o', color='red')
axs[1, 1].set_title('Water Level')
axs[1, 1].set_ylabel('Water Level')
axs[2, 1].set_ylim(0, 1)

# Soil moisture of plant 1 plot
axs[2, 0].plot(timestamps, soil_moisture_plant1, marker='o', color='purple')
axs[2, 0].set_title('Soil Moisture Plant 1')
axs[2, 0].set_ylabel('Soil Moisture (%)')
axs[2, 0].set_ylim(0, 100)

# Soil moisture of plant 2 plot
axs[2, 1].plot(timestamps, soil_moisture_plant2, marker='o', color='brown')
axs[2, 1].set_title('Soil Moisture Plant 2')
axs[2, 1].set_ylabel('Soil Moisture (%)')
axs[2, 1].set_ylim(0, 100)

# Battery percentage plot
axs[3, 0].plot(timestamps, battery_percentages, marker='o', color='cyan')
axs[3, 0].set_title('Battery Percentage')
axs[3, 0].set_ylabel('Battery (%)')
axs[3, 0].set_xlabel('Timestamp')
axs[3, 0].set_ylim(0, 100)

# Remove unused subplot (bottom-right)
fig.delaxes(axs[3, 1])

# Display the plot
plt.show()

print()